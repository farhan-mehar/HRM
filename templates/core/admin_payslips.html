{% extends 'core/base.html' %}
{% block page_title %}Payslips{% endblock %}
{% block content %}
<div class="card mt-4">
  <div class="card-body">
    <h4 class="card-title">Payslips (Admin)</h4>
    <form method="post" class="mb-4">
      {% csrf_token %}
      <div class="row g-2">
        <div class="col-md-3">{{ form.employee }}</div>
        <div class="col-md-2">{{ form.period_start }}</div>
        <div class="col-md-2">{{ form.period_end }}</div>
        <div class="col-md-2">{{ form.base_salary }}</div>
        <div class="col-md-2 form-check form-switch">{{ form.send_email }} <label class="form-check-label">Email to employee</label></div>
        <div class="col-md-1"><button type="submit" class="btn btn-primary w-100">Create</button></div>
      </div>
    </form>
    <table class="table table-bordered">
      <thead><tr><th>Employee</th><th>Period</th><th>Gross</th><th>Earnings</th><th>Deductions</th><th>Net</th><th>Status</th><th>Created</th><th>Actions</th></tr></thead>
      <tbody>
        {% for payslip in payslips %}
        <tr>
          <td>{{ payslip.employee }}</td>
          <td>{{ payslip.period_start }} - {{ payslip.period_end }}</td>
          <td>{{ payslip.gross_pay }}</td>
          <td>{{ payslip.total_earnings }}</td>
          <td>{{ payslip.total_deductions }}</td>
          <td>{{ payslip.total }}</td>
          <td>{{ payslip.get_status_display }}</td>
          <td>{{ payslip.created_at|date:'Y-m-d H:i' }}</td>
          <td>
            <a href="{% url 'edit_payslip' payslip.id %}" class="btn btn-sm btn-outline-primary">Edit</a>
            <a href="{% url 'delete_payslip' payslip.id %}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this payslip?');">Delete</a>
            {% if payslip.pdf %}
            <a href="{{ payslip.pdf.url }}" target="_blank" class="btn btn-sm btn-outline-secondary">PDF</a>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="9">No payslips found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %} 